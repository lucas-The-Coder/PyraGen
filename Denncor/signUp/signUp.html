<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/signUp/signUp.css" />
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- Google Sign-In JavaScript -->
    <script>
      window.onload = function () {
        const clientId =
          "607162529259-5chubrqc43e4teb444a35a61ns7fjkl8.apps.googleusercontent.com";
        const redirectUri = "http://127.0.0.1:3000/oauth2callback";
        const scope = "profile email";
        const state = "signUp";
        const responseType = "code";
        const oauthUrl =
          "https://accounts.google.com/o/oauth2/auth?client_id=607162529259-5chubrqc43e4teb444a35a61ns7fjkl8.apps.googleusercontent.com&redirect_uri=http://127.0.0.1:3000/oauth2callback&response_type=code&scope=https://www.googleapis.com/auth/userinfo.email";

        google.accounts.id.initialize({
          client_id:
            "607162529259-5chubrqc43e4teb444a35a61ns7fjkl8.apps.googleusercontent.com",
          callback: handleCredentialResponse,
          redirect_uri: "http://127.0.0.1:3000/oauth2callback",
          oauthUrl:
            "https://accounts.google.com/o/oauth2/auth?client_id=607162529259-5chubrqc43e4teb444a35a61ns7fjkl8.apps.googleusercontent.com&redirect_uri=http://127.0.0.1:3000/oauth2callback&response_type=code&scope=https://www.googleapis.com/auth/userinfo.email",
          scope: "profile email",
          debug: true,
        });
        google.accounts.id.renderButton(
          document.getElementById("g-sign-in-button"),
          { theme: "outline", size: "large" }
        );

        // Check if the user is already logged in
        const authToken = localStorage.getItem("authToken");
        if (authToken) {
          const token = authToken.split(".")[1];
          const userInfo = JSON.parse(atob(token));
          console.log("User Info:", userInfo);

          // Display user info
          document.body.innerHTML += `<h3 id="greet">Welcome, ${userInfo.name}!</h3>
                                  <img src="${userInfo.picture}" alt="Profile Picture"/>`;
        }

        function handleCredentialResponse(response) {
          console.log("ID Token:", response.credential);

          // Decode JWT (for display purposes)
          const userInfo = JSON.parse(atob(response.credential.split(".")[1]));
          console.log("User Info:", userInfo);

          // Store the user's authentication token in localStorage
          localStorage.setItem("authToken", response.credential);

          // Display user info
          document.body.innerHTML += `<h3 id="greet">Welcome, ${userInfo.name}!</h3>
                                  <img src="${userInfo.picture}" alt="Profile Picture"/>`;

          // Redirect the user to the home page (index.html)
          window.location.href = "../index.html";
        }
      };
    </script>

    <!-- Sign-up JavaScript -->
    <script>
      function generateAuthToken(user) {
        return Math.random().toString(36).substr(2, 10); // Simple token generation for demo purposes
      }

      function signUp() {
        document
          .getElementById("sign-up-button")
          .addEventListener("click", function (e) {
            e.preventDefault();

            const firstName = document.getElementById("first-name").value;
            const lastName = document.getElementById("last-name").value;
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            if (!firstName || !lastName || !email || !password) {
              console.error("Error: Please fill in all fields.");
              return;
            }

            // Store user data in local storage
            const userData = {
              firstName: firstName,
              lastName: lastName,
              email: email,
              password: password,
            };
            localStorage.setItem("userData", JSON.stringify(userData));

            // Log userData to the console
            console.log(userData);

            // Generate an authToken and assign it to the new user
            const authToken = generateAuthToken(userData);
            localStorage.setItem("authToken", authToken);

            // Redirect the user to the home page
            window.location.href = "../index.html";
          });
      }
    </script>
    <title>Sign Up</title>
  </head>
  <body>
    <div class="container">
      <h1 id="sign-up-header">Sign Up</h1>

      <h3>First Name</h3>
      <input type="text" id="first-name" required />

      <h3>Last Name</h3>
      <input type="text" id="last-name" required />

      <h3>Email</h3>
      <input type="email" id="email" required />

      <h3>Password</h3>
      <input type="password" id="password" required />

      <button id="sign-up-button" onclick="signUp()">Sign Up</button>

      <h3>Or</h3>

      <div id="g-sign-in-button"></div>
    </div>
  </body>
</html>
